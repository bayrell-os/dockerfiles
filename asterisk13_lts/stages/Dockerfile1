FROM bayrell/asterisk13_lts:stage0


RUN cd ~; \
	
	
	echo "[2] Install PJSIP"; \
	cd /src/tmp; \
	mv /src/install/download/pjproject-2.7.2.tar.bz2 ./; \
	tar xf pjproject-2.7.2.tar.bz2; \
	cd pjproject-2.7.2; \
	./configure --prefix=/usr --enable-shared --disable-sound --disable-resample --disable-video --disable-opencore-amr CFLAGS='-O2 -DNDEBUG'; \
	make dep && make && make install; \
	ldconfig; \

	
	
	
	echo "[3] Install Asterisk"; \
	cd /src/tmp; \
	mv /src/install/download/asterisk-certified-13.18-current.tar.gz ./; \
	tar xf asterisk-certified-13.18-current.tar.gz; \
	cd asterisk-certified-13.18-current; \
	./contrib/scripts/install_prereq install; \
	./contrib/scripts/install_prereq install-unpackaged; \
	./contrib/scripts/get_mp3_source.sh; \
	./configure --prefix=/usr --sysconfdir=/etc --without-dahdi --without-pri --without-gtk2 --without-radius --without-x11 --libdir=/usr/lib64 --with-pjproject-bundled; \
	make menuselect.makeopts; \
	
	
	./menuselect/menuselect --enable app_mysql --enable cdr_mysql --enable format_mp3 --enable res_config_mysql --enable app_setcallerid --enable codec_opus --enable CORE-SOUNDS-EN-WAV --enable CORE-SOUNDS-EN-ULAW --enable CORE-SOUNDS-EN-ALAW --enable CORE-SOUNDS-EN-GSM --enable CORE-SOUNDS-EN-G729 --enable CORE-SOUNDS-EN-G722 --enable CORE-SOUNDS-EN-SLN16 --enable CORE-SOUNDS-EN-SIREN7 --enable CORE-SOUNDS-EN-SIREN14 --enable CORE-SOUNDS-RU-WAV --enable CORE-SOUNDS-RU-ULAW --enable CORE-SOUNDS-RU-ALAW --enable CORE-SOUNDS-RU-GSM --enable CORE-SOUNDS-RU-G722 --enable CORE-SOUNDS-RU-G729 --enable CORE-SOUNDS-RU-SLN16 --enable CORE-SOUNDS-RU-SIREN7 --enable CORE-SOUNDS-RU-SIREN14 --enable MOH-OPSOUND-WAV --enable MOH-OPSOUND-ULAW --enable MOH-OPSOUND-ALAW --enable MOH-OPSOUND-GSM --enable MOH-OPSOUND-G729 --enable MOH-OPSOUND-G722 --enable MOH-OPSOUND-SLN16 --enable MOH-OPSOUND-SIREN7 --enable MOH-OPSOUND-SIREN14 --enable EXTRA-SOUNDS-EN-WAV --enable EXTRA-SOUNDS-EN-ULAW --enable EXTRA-SOUNDS-EN-ALAW --enable EXTRA-SOUNDS-EN-GSM --enable EXTRA-SOUNDS-EN-G729 --enable EXTRA-SOUNDS-EN-G722 --enable EXTRA-SOUNDS-EN-SLN16 --enable EXTRA-SOUNDS-EN-SIREN7 --enable EXTRA-SOUNDS-EN-SIREN14; \
	
	
	make && make install && make config && make samples && make basic-pbx; \
	
	
	useradd -m asterisk; \
	chown asterisk:asterisk /var/run/asterisk; \
	chown -R asterisk:asterisk /etc/asterisk; \
	chown -R asterisk:asterisk /var/{lib,log,spool}/asterisk; \
	chown -R asterisk:asterisk /usr/lib64/asterisk; \
	
	
	rm -rf /src/tmp/*; 
	
